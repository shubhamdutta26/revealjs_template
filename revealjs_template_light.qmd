---
title: "revealjs_template"
format: 
  revealjs:
    height: 1080
    width: 1920
brand: brand_light_sd.yml
---

##

```{r}
#| label: setup

library(ggplot2)
library(dplyr)
library(sdtools)

knitr::opts_chunk$set(dev = "ragg_png", dpi = 400)

sd_colors <- c(
  "green" = "#00a5a6",
  "pink" = "#e03d90",
  light_text = "#323A30",
  dark_text = "#0C1509"
)
```

```{r}
#| label: bar-plot-data

plot_data <- ToothGrowth |>
  mutate(
    supplement = case_when(
      supp == "OJ" ~ "green",
      supp == "VC" ~ "pink",
      TRUE ~ as.character(supp)
    )
  ) |>
  group_by(supplement, dose) |>
  summarise(mean_length = mean(len), .groups = "drop") |>
  mutate(
    categorical_dose = factor(dose),
    dose_label = paste0(dose, "mg/day")
  )
```

```{r}
#| label: horizontal-bar-plot
#| fig-height: 10
#| fig-width: 15
#| eval: false

ggplot(
  plot_data,
  aes(x = categorical_dose, y = mean_length, fill = supplement)
) +
  geom_bar(aes(alpha = dose), stat = "identity", colour = "#FFFFFF", size = 2) +
  ggtext::geom_textbox(
    data = plot_data,
    aes(
      label = paste0(
        "<span style=font-size:12pt>",
        dose_label,
        "</span><br>",
        janitor::round_half_up(mean_length),
        "mm"
      ),
      hjust = if_else(mean_length < 15, 0, 1),
      halign = if_else(mean_length < 15, 0, 1),
      colour = if_else(
        mean_length > 15,
        "#FFFFFF",
        sd_colors[supplement]
      )
    ),
    size = 6,
    fill = NA,
    box.colour = NA,
    family = "Cabin",
    fontface = "bold"
  ) +
  labs(
    x = "Dose",
    y = "Mean length (mm)",
    title = paste0(
      "This is **<span style='color:",
      sd_colors["green"],
      "'>green</span>** and that is **<span style='color:",
      sd_colors["pink"],
      "'>pink</span>**"
    ),
    subtitle = "With the highest dose, the mean recorded length was almost identical."
  ) +
  scale_fill_manual(values = sd_colors) +
  scale_alpha(range = c(0.4, 1)) +
  scale_colour_identity() +
  scale_x_discrete(
    breaks = c("0.5", "1", "2"),
    labels = function(x) paste0(x, " mg/day")
  ) +
  scale_y_continuous(expand = expansion(0), limits = c(0, 30)) +
  coord_flip() +
  facet_wrap(supplement ~ ., ncol = 1) +
  theme_sd_2(base_size = 15) +
  theme(
    legend.position = "none",
    text = element_text(colour = sd_colors["light_text"], family = "Cabin"),
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 20),
    plot.title = ggtext::element_textbox_simple(
      colour = sd_colors["dark_text"],
      size = rel(5),
      face = "bold",
      family = "Enriqueta",
      lineheight = 1.3,
      margin = margin(0.5, 0, 1, 0, "lines")
    ),
    plot.subtitle = ggtext::element_textbox_simple(
      family = "Cabin",
      size = rel(2),
      lineheight = 1.3,
      margin = margin(0, 0, 1, 0, "lines")
    ),
    strip.text = element_text(
      family = "Enriqueta",
      colour = sd_colors["light_text"],
      size = rel(2),
      face = "bold",
      margin = margin(2, 0, 1, 0, "lines"),
      hjust = 0
    ),
    strip.background = element_rect(fill = NA, color = NA),
    axis.text = element_text(size = 15, colour = sd_colors["light_text"]),
    plot.title.position = "plot",
    panel.spacing = unit(2, "lines"),
    plot.margin = margin(1, 2, 1, 1, "lines")
  )
```

##

```{r}
#| label: vertical-bar-plot
#| fig-height: 10
#| fig-width: 15

ggplot(
  plot_data,
  aes(x = categorical_dose, y = mean_length, fill = supplement)
) +
  geom_bar(aes(alpha = dose), stat = "identity", colour = "#FFFFFF", size = 2) +
  ggtext::geom_textbox(
    data = plot_data,
    aes(
      label = paste0(
        "<span style=font-size:12pt>",
        dose_label,
        "</span><br>",
        janitor::round_half_up(mean_length),
        "mm"
      ),
      vjust = if_else(mean_length < 15, 0, 1),# placing text in the top (0), middle (0.5), bottom (1) top of the bar
      valign = 1, # no change for this plot
      hjust = 0.5, # placing text in the left (0), center (0.5), right (1) of the bar
      halign = 0.5, # align text in the left (0), center (0.5), right (1) top of the bar
      colour = if_else(
        mean_length > 15,
        "#FFFFFF",
        sd_colors[supplement]
      )
    ),
    size = 6,
    fill = NA,
    box.colour = NA,
    family = "Cabin",
    fontface = "bold"
  ) +
  labs(
    x = "Dose",
    y = "Mean length (mm)",
    title = paste0(
      "This is **<span style='color:",
      sd_colors["green"],
      "'>green</span>** and that is **<span style='color:",
      sd_colors["pink"],
      "'>pink</span>**"
    ),
    subtitle = "With the highest dose, the mean recorded length was almost identical."
  ) +
  scale_fill_manual(values = sd_colors) +
  scale_alpha(range = c(0.4, 1)) +
  scale_colour_identity() +
  scale_x_discrete(
    breaks = c("0.5", "1", "2"),
    labels = function(x) paste0(x, " mg/day")
  ) +
  scale_y_continuous(expand = expansion(0), limits = c(0, 30)) +
  facet_wrap(supplement ~ ., nrow = 1) +
  theme_sd_2(base_size = 15) +
  theme(
    legend.position = "none",
    text = element_text(colour = sd_colors["light_text"], family = "Cabin"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 20),
    plot.title = ggtext::element_textbox_simple(
      colour = sd_colors["dark_text"],
      size = rel(5),
      face = "bold",
      family = "Enriqueta",
      lineheight = 1.3,
      margin = margin(0.5, 0, 1, 0, "lines")
    ),
    plot.subtitle = ggtext::element_textbox_simple(
      family = "Cabin",
      size = rel(2),
      lineheight = 1.3,
      margin = margin(0, 0, 1, 0, "lines")
    ),
    strip.text = element_text(
      family = "Enriqueta",
      colour = sd_colors["light_text"],
      size = rel(2),
      face = "bold",
      margin = margin(2, 0, 1, 0, "lines"),
      hjust = 0
    ),
    strip.background = element_rect(fill = NA, color = NA),
    axis.text = element_text(size = 15, colour = sd_colors["light_text"]),
    plot.title.position = "plot",
    panel.spacing = unit(2, "lines"),
    plot.margin = margin(1, 2, 1, 1, "lines")
  )
```

